<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Carte M√©t√©o - M√©t√©orite </title>
<link href="/julien/background.css" rel="stylesheet"/>
<link href="/assets/css/main.css" rel="stylesheet"/>
<link href="/assets/css/components.css" rel="stylesheet"/>
<link href="/julien/styles.css" rel="stylesheet"/>
<link href="/assets/css/merge-adapter.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script>
(function(){
  try {
    const theme = localStorage.getItem('meteorite_theme') || 'dark';
    document.documentElement.setAttribute('data-theme', theme);
  } catch(e) {}
})();
</script>
<style>
body {
  background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%) !important;
  min-height: 100vh;
  position: relative;
}
.header {
  background: rgba(255, 255, 255, 0.08) !important;
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
[data-theme="light"] .header {
  background: rgba(255, 255, 255, 0.95) !important;
}
[data-theme="light"] body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

#map {
  height: 500px;
  width: 100%;
  border-radius: 24px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  margin-top: 20px;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.city-marker {
  background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
  color: white;
  padding: 8px 15px;
  border-radius: 18px;
  font-weight: 600;
  font-size: 13px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  border: 2px solid white;
  text-align: center;
  min-width: 80px;
}

.map-container {
  position: relative;
  z-index: 10;
  max-width: 1000px;
  margin: 40px auto;
  padding: 0 20px;
}

.map-title {
  text-align: center;
  color: var(--text-dark);
  font-size: clamp(24px, 4vw, 36px);
  margin-bottom: 30px;
}

.map-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

.btn-city {
  padding: 10px 20px;
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 20px;
  color: var(--text-dark);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  backdrop-filter: blur(10px);
}

.btn-city:hover,
.btn-city.active {
  background: var(--primary-blue);
  color: white;
  transform: translateY(-2px);
}
</style>
</head>
<body>

<div id="stars"></div>
<div id="stars2"></div>
<div id="stars3"></div>

<header class="header">
<div class="header-content">
<div class="logo">
<img alt="Logo" class="logo-img" src="/assets/images/Logo_meteorite2.png"/>
<span class="logo-text">M√©t√©orite</span>
</div>
<nav class="nav-menu" id="navMenu">
<a class="nav-link" href="/index.html">M√©t√©o</a>
<a class="nav-link active" href="/carte.html">Carte</a>
<a class="nav-link" href="/favorites-page.html">Favoris</a>
<a class="nav-link" href="/alerts-page.html">Alertes</a>
<a class="nav-link" href="/settings-page.html">Param√®tres</a>
</nav>
<div class="user-actions">
<button class="theme-toggle" id="themeToggle" title="Changer de th√®me">üåô</button>
<div class="user-info" id="userInfo" style="display: none;">
<span class="user-name" id="userName"></span>
<button class="btn-logout" id="logoutBtn">D√©connexion</button>
</div>
<div id="authButtons" style="display: flex; gap: 10px;">
<a class="btn-register" href="/julien/register.html">Inscription</a>
<a class="btn-login" href="/julien/login.html">Connexion</a>
</div>
</div>
<button class="mobile-menu-toggle" id="mobileMenuToggle">‚ò∞</button>
</div>
</header>

<div class="map-container">
  <h1 class="map-title">üó∫Ô∏è Carte M√©t√©o Interactiv</h1>

  <div class="map-controls">
    <button class="btn-city" data-city="Paris" data-lat="48.8566" data-lon="2.3522">Paris</button>
    <button class="btn-city" data-city="Marseille" data-lat="43.2965" data-lon="5.3698">Marseille</button>
    <button class="btn-city" data-city="Lyon" data-lat="45.7640" data-lon="4.8357">Lyon</button>
    <button class="btn-city" data-city="Toulouse" data-lat="43.6047" data-lon="1.4442">Toulouse</button>
    <button class="btn-city" data-city="Nice" data-lat="43.7102" data-lon="7.2620">Nice</button>
    <button class="btn-city" data-city="Bordeaux" data-lat="44.8378" data-lon="-0.5792">Bordeaux</button>
  </div>

  <div id="map"></div>
</div>

<footer class="app-footer">
<small>Donn√©es cartographiques: <a href="https://openstreetmap.org" rel="noopener" target="_blank">OpenStreetMap</a> ‚Ä¢ M√©t√©o: <a href="https://open-meteo.com" rel="noopener" target="_blank">Open‚ÄëMeteo</a></small>
</footer>

<script>
function createStars(id, count, size) {
  const stars = [];
  for (let i = 0; i < count; i++) {
    const x = Math.floor(Math.random() * 2000);
    const y = Math.floor(Math.random() * 2000);
    stars.push(`${x}px ${y}px #FFF`);
  }
  const el = document.getElementById(id);
  el.style.width = size + 'px';
  el.style.height = size + 'px';
  el.style.boxShadow = stars.join(', ');
}

createStars('stars', 200, 1);
createStars('stars2', 100, 2);
createStars('stars3', 50, 3);
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script type="module" src="/assets/js/theme.js"></script>
<script type="module">
  const cities = [
    { name: 'Paris', lat: 48.8566, lon: 2.3522 },
    { name: 'Marseille', lat: 43.2965, lon: 5.3698 },
    { name: 'Lyon', lat: 45.7640, lon: 4.8357 },
    { name: 'Toulouse', lat: 43.6047, lon: 1.4442 },
    { name: 'Nice', lat: 43.7102, lon: 7.2620 },
    { name: 'Nantes', lat: 47.2184, lon: -1.5536 },
    { name: 'Strasbourg', lat: 48.5734, lon: 7.7521 },
    { name: 'Bordeaux', lat: 44.8378, lon: -0.5792 },
    { name: 'Lille', lat: 50.6292, lon: 3.0573 },
    { name: 'Rennes', lat: 48.1173, lon: -1.6778 }
  ];

  const map = L.map('map').setView([46.603354, 1.888334], 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap',
    maxZoom: 18
  }).addTo(map);

  async function getWeatherData(lat, lon) {
    try {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
      const response = await fetch(url);
      return await response.json();
    } catch (error) {
      return null;
    }
  }

  function getWeatherIcon(code) {
    const icons = {
      0: '‚òÄÔ∏è', 1: 'üå§', 2: '‚õÖ', 3: '‚òÅÔ∏è',
      45: 'üå´', 61: 'üåß', 63: 'üåß', 65: 'üåß',
      71: 'üå®', 95: '‚õà'
    };
    return icons[code] || '‚ùì';
  }

  async function addCityMarkers() {
    for (const city of cities) {
      const weatherData = await getWeatherData(city.lat, city.lon);

      if (weatherData && weatherData.current_weather) {
        const temp = Math.round(weatherData.current_weather.temperature);
        const icon = getWeatherIcon(weatherData.current_weather.weathercode);

        const markerIcon = L.divIcon({
          className: 'city-marker',
          html: `
            <div>
              <strong>${city.name}</strong><br>
              ${icon} ${temp}¬∞C
            </div>
          `,
          iconSize: [100, 50],
          iconAnchor: [50, 25]
        });

        const marker = L.marker([city.lat, city.lon], { icon: markerIcon }).addTo(map);

        marker.on('click', () => {
          window.location.href = `/index.html?city=${encodeURIComponent(city.name)}`;
        });
      }
    }
  }

  document.querySelectorAll('.btn-city').forEach(btn => {
    btn.addEventListener('click', () => {
      const lat = parseFloat(btn.dataset.lat);
      const lon = parseFloat(btn.dataset.lon);

      document.querySelectorAll('.btn-city').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      map.flyTo([lat, lon], 10, { duration: 1.5 });
    });
  });

  addCityMarkers();
</script>
</body>
</html>
