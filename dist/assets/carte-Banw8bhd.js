import"./components-BVSRcDa7.js";import{createClient as m}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const d="https://djpigduzgtzlktpyhhgf.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqcGlnZHV6Z3R6bGt0cHloaGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNTMwMzQsImV4cCI6MjA3NjcyOTAzNH0.xqxv2LGs-dXSXDg_ccXzhAY02lP8KxOZ_TpXXZlmAUQ",o=m(d,u),g=[{name:"Paris",lat:48.8566,lon:2.3522},{name:"Marseille",lat:43.2965,lon:5.3698},{name:"Lyon",lat:45.764,lon:4.8357},{name:"Toulouse",lat:43.6047,lon:1.4442},{name:"Nice",lat:43.7102,lon:7.262},{name:"Nantes",lat:47.2184,lon:-1.5536},{name:"Strasbourg",lat:48.5734,lon:7.7521},{name:"Bordeaux",lat:44.8378,lon:-.5792},{name:"Lille",lat:50.6292,lon:3.0573},{name:"Rennes",lat:48.1173,lon:-1.6778},{name:"Montpellier",lat:43.6108,lon:3.8767},{name:"Reims",lat:49.2583,lon:4.0317},{name:"Le Havre",lat:49.4944,lon:.1079},{name:"Dijon",lat:47.322,lon:5.0415},{name:"Grenoble",lat:45.1885,lon:5.7245},{name:"Angers",lat:47.4784,lon:-.5632},{name:"Toulon",lat:43.1242,lon:5.928},{name:"Brest",lat:48.3904,lon:-4.4861},{name:"Clermont-Ferrand",lat:45.7772,lon:3.087},{name:"Rouen",lat:49.4432,lon:1.0993}],l=L.map("map").setView([46.603354,1.888334],6);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors",maxZoom:18}).addTo(l);async function h(e,t){try{const n=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&current_weather=true`;return await(await fetch(n)).json()}catch(n){return console.error("Erreur m√©t√©o:",n),null}}function y(e){return{0:"‚òÄÔ∏è",1:"üå§",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´",61:"üåß",63:"üåß",65:"üåß",71:"üå®",95:"‚õà"}[e]||"‚ùì"}async function p(){for(const e of g){const t=await h(e.lat,e.lon);if(t&&t.current_weather){const n=Math.round(t.current_weather.temperature),a=y(t.current_weather.weathercode),s=L.divIcon({className:"city-marker",html:`
                            <div>
                                <div><strong>${e.name}</strong></div>
                                <div class="weather-info">${a} ${n}¬∞C</div>
                            </div>
                        `,iconSize:[100,60],iconAnchor:[50,30]});L.marker([e.lat,e.lon],{icon:s}).addTo(l).on("click",()=>{window.location.href=`/index.html?lat=${e.lat}&lon=${e.lon}&city=${encodeURIComponent(e.name)}`})}}}document.querySelectorAll(".btn-city").forEach(e=>{e.addEventListener("click",()=>{e.dataset.city;const t=parseFloat(e.dataset.lat),n=parseFloat(e.dataset.lon);document.querySelectorAll(".btn-city").forEach(a=>a.classList.remove("active")),e.classList.add("active"),l.flyTo([t,n],10,{duration:1.5})})});async function I(){const e=await f();if(e){const t=await w(e.id);t&&(document.getElementById("userName").textContent=t.first_name||t.email,document.getElementById("userInfo").style.display="flex",document.getElementById("loginBtn").style.display="none")}else document.getElementById("loginBtn").style.display="inline-block";await p()}async function f(){const{data:{user:e}}=await o.auth.getUser();return e}async function w(e){const{data:t}=await o.from("profiles").select("*").eq("id",e).maybeSingle();return t}var r;(r=document.getElementById("logoutBtn"))==null||r.addEventListener("click",async()=>{await o.auth.signOut(),window.location.href="/login.html"});var c;(c=document.getElementById("mobileMenuToggle"))==null||c.addEventListener("click",()=>{document.getElementById("navMenu").classList.toggle("active")});var i;(i=document.getElementById("themeToggle"))==null||i.addEventListener("click",()=>{const t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",t),document.getElementById("themeToggle").textContent=t==="light"?"üåô":"‚òÄÔ∏è",localStorage.setItem("meteorite_theme",t)});I();
