import"./components-BVSRcDa7.js";import{g as l,a as c,d as a,s as u}from"./supabase-client-DwhNdNLI.js";import{g,s as m}from"./storage-xgazSgyw.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm";let o=null,n=null;async function y(){if(o=await l(),!o){document.getElementById("loginRequired").style.display="block",document.getElementById("settingsContent").style.display="none",setTimeout(()=>document.getElementById("loader").classList.add("hidden"),500);return}if(n=await c(o.id),n){document.getElementById("userName").textContent=n.first_name||n.email,document.getElementById("userEmail").value=n.email,document.getElementById("firstName").value=n.first_name||"";const t=n.theme_preference==="dark";document.getElementById("darkModeToggle").checked=t,i(n.theme_preference||g())}document.getElementById("settingsContent").style.display="block",h(),setTimeout(()=>document.getElementById("loader").classList.add("hidden"),500)}function h(){document.getElementById("updateProfileBtn").addEventListener("click",f),document.getElementById("logoutBtn").addEventListener("click",B),document.getElementById("themeToggle").addEventListener("click",p),document.getElementById("darkModeToggle").addEventListener("change",E),document.getElementById("mobileMenuToggle").addEventListener("click",()=>document.getElementById("navMenu").classList.toggle("active"))}async function f(){const t=document.getElementById("firstName").value.trim();if(!t){r("Le prénom ne peut pas être vide");return}try{const{error:e}=await a.from("profiles").update({first_name:t}).eq("id",o.id);if(e)throw e;k("Profil mis à jour"),n.first_name=t,document.getElementById("userName").textContent=t}catch{r("Erreur lors de la mise à jour")}}async function E(t){const s=t.target.checked?"dark":"light";try{const{error:d}=await a.from("profiles").update({theme_preference:s}).eq("id",o.id);if(d)throw d;i(s),m(s)}catch{r("Erreur lors de la sauvegarde du thème")}}function p(){const e=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light";document.getElementById("darkModeToggle").checked=e==="dark",i(e),m(e),o&&a.from("profiles").update({theme_preference:e}).eq("id",o.id)}function i(t){document.documentElement.setAttribute("data-theme",t),document.getElementById("themeToggle").textContent=t==="light"?"🌙":"☀️"}async function B(){try{await u(),window.location.href="/main.html"}catch{r("Erreur lors de la déconnexion")}}function r(t){const e=document.getElementById("errorMessage");e.textContent=t,e.className="error-message",e.style.display="block",setTimeout(()=>e.style.display="none",5e3)}function k(t){const e=document.getElementById("successMessage");e.textContent=t,e.className="success-message",e.style.display="block",setTimeout(()=>e.style.display="none",5e3)}y();
